<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.b4.apollo.product.model.dao.ProductDAO">

    <resultMap type="com.b4.apollo.product.model.dto.ProductDTO" id="productResultMap">
        <id property="productNo" column="PRODUCT_NO"/>
        <result property="productName" column="PRODUCT_NAME"/>
        <result property="productPrice" column="PRODUCT_PRICE"/>
        <result property="productDesc" column="PRODUCT_DESC"/>
        <result property="productQty" column="PRODUCT_QTY"/>
        <result property="categoryCode" column="CATEGORY_CODE"/>
    </resultMap>

    <select id="productList" resultMap="productResultMap"><!-- ?????? ????-->
        SELECT
            A.*
        FROM TBL_PRODUCT A
        WHERE A.PRODUCT_QTY > 0
    </select>
    <select id="productDetail" resultMap="productResultMap"><!-- ?????? ????-->
        SELECT
            A.*
        FROM TBL_PRODUCT A
        WHERE A.PRODUCT_NO = #{productNo}
    </select>


    <insert id = "registProduct">
BEGIN
        INSERT
        INTO TBL_PRODUCT A
            (
               A.PRODUCT_NO
             , A.PRODUCT_NAME
             , A.PRODUCT_PRICE
             , A.PRODUCT_DESC
             , A.PRODUCT_QTY
             , A.CATEGORY_CODE
        )
        VALUES
            (
            SEQ_PRODUCT_NO.NEXTVAL
                , #{ name }
                , #{ price }
                , #{ description }
                , #{ quantity }
                , #{ categoryCode }

            );
        INSERT
        INTO TBL_PRODUCT_IMAGE B
        (
            B.FILE_NO
        , B.ORIGIN_NAME
        , B.STORED_NAME
        , B.THUMBNAIL
        , B.PRODUCT_NO
        )
        VALUES
            (
            SEQ_FILE_NO.NEXTVAL
                , #{ origin }
                , #{ stored }
                , #{ isThumbnail }
                , #{ productNo }
-- product no 를 시퀀스로 하면 괜히 숫자 두개가 +되나?
            );
INSERT
INTO TBL_PRODUCT_IMAGE B
    (
            B.FILE_NO
        , B.ORIGIN_NAME
        , B.STORED_NAME
        , B.THUMBNAIL
        , B.PRODUCT_NO
        )
VALUES
    (
    SEQ_FILE_NO.NEXTVAL
        , #{ origin }
        , #{ stored }
        , #{ isThumbnail }
        , #{ productNo }
-- product no 를 시퀀스로 하면 괜히 숫자 두개가 +되나?
    );
INSERT
INTO TBL_PRODUCT_IMAGE B
    (
            B.FILE_NO
        , B.ORIGIN_NAME
        , B.STORED_NAME
        , B.THUMBNAIL
        , B.PRODUCT_NO
        )
VALUES
    (
    SEQ_FILE_NO.NEXTVAL
        , #{ origin }
        , #{ stored }
        , #{ isThumbnail }
        , #{ productNo }
-- product no 를 시퀀스로 하면 괜히 숫자 두개가 +되나?
    );
END;
    </insert>

    <!-- 예약 수정 -->
    <update id="editProduct">
        UPDATE TBL_PRODUCT A
            A.PRODUCT_NAME = #{ name }
          , A.PRODUCT_PRICE = #{ price }
          , A.PRODUCT_DESC = #{ description }
          , A.PRODUCT_QTY = #{ quantity }
          , A.CATEGORY_CODE = #{ categoryCode }
        WHERE A.PRODUCT_NO = #{ productNo }
and
        UPDATE TBL_PRODUCT_IMAGE
            B.FILE_NO
            , B.ORIGIN_NAME
            , B.STORED_NAME
            , B.THUMBNAIL
            , B.PRODUCT_NO
        WHERE A.PRODUCT_NO = #{ productNo }
    </update>

    <!-- 예약 삭제 -->
    <delete id="deleteReserve">
        DELETE
        FROM TBL_
        WHERE RESERVE_NO = #{ reserve_no }
    </delete>
</mapper>