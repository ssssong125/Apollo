<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en"
      layout:decorate="~{/common/layout}"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf?.token}">
    <meta name="_csrf_header" th:content="${_csrf?.headerName}">

    <title>Cart</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script  src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<!--    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>-->
    <script type="text/javascript" th:src="@{/js/cart/trolley.js}"></script>
    <link rel="stylesheet" type="text/css" th:href="@{ /css/cart/style.css }">
    <style>
        /*div 확인용*/
        /*div{*/
        /*    border: solid red 1px;*/
        /*}*/
    </style>
    <script th:inline="javascript">
        /*타임리프 변수 기본값 0*/
        const size = /*[[ ${cartList?.size()} ]]*/ '0';
        const point = /*[[ ${user?.point} ]]*/ '0';

    </script>
</head>
<body>
<!--    <div th:include="fragments/header.html"></div>-->
    <!--전체 div-->
    <div layout:fragment="content" class="container">
        <br>
        <!--현재 위치-->
        <div class="row">
            <div class="col">
                <span class="big-font">Cart</span>
                <hr class="thick-line">
            </div>
        </div>
        <!--제목-->
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    Items
                </div>
                <div class="col-lg-1">
                    Qty
                </div>
                <div class="col-lg-2 price">
                    Price
                </div>
            </div>
        </div>
        <!--상품 없을시-->
        <div class="container" th:if="${ cartList?.size() } == 0">
            <hr class="line">
            <div class="row">
                <div class="col-lg" style="height: 128px;" >
                    <div class="v-align" style="text-align: center;">
                        <br><br>
                        장바구니에 상품이 없습니다.
                    </div>
                </div>
            </div>
        </div>
        <!--상품 추가시-->
            <th:block th:each="cart : ${ cartList }" th:if="${ cartList?.size() } > 0">
<!--                <input type="text" th:field="${cart.cartNo}" th:if="">-->
                <input type="hidden" class="size" id="size" th:value="${ cartList?.size() }">
                <div class="container product-box">
                    <hr class="line">
                    <div class="row">
                        <div class="col-lg-1 v-align" style="text-align: center">
                            <!--체크 값 확인-->
<!--                            <span th:text="${cart.checkStatus}"/>-->
                            <input th:id="|checkBox${cartStat.count}|" type="checkbox" class="checkStatus" th:value="${cart.cartNo}" th:checked="${cart.checkStatus} == 'Y'">
<!--                            체크됐을때 쿼리로 yn넣고 밸류는 카트넘버-->
                        </div>
                        <!--상품 이미지-->
                        <div class="col-lg-2">
                            <img class="product" src="/img/cart/naverPay.png" alt="상품 이미지명">
    <!--                        <img class="product" th:src="/img/cart/${ aa.imgName }" alt="상품 이미지명">-->
                        </div>
                        <!--상품명-->
                        <div class="col-lg-5 v-align">
                            <span th:text="${ cart?.productInfo?.productName }"/>
                        </div>
                        <!--상품 갯수-->
                        <div class="col-lg-1 v-align">
                            <input type="number" th:id="|productQty${cartStat?.count}|" class="productQty"
                                   th:onchange="|updateQty(${ cart?.cartNo },${ cartStat?.count },${cart.productInfo.productQty})|"
                                   th:value="${ cart?.productCount }"
                                   min="1" th:max="${ cart?.productInfo?.productQty }"
                                   style="width: 50px" required>
                        </div>
                        <!--상품 가격-->
                        <div class="col-lg-2 v-align price">
                            <span th:id="|price${cartStat?.count}|" th:text="${ cart?.productInfo?.productPrice }" th:value="${ cart.productInfo.productPrice }"/>$
                            <input th:id="|hiddenPrice${cartStat?.count}|" th:value="${ cart?.productInfo?.productPrice }" type="hidden">
                        </div>
                        <!--상품 삭제-->
                        <div class="col-lg-1 v-align price">
                                <!--타임리프 이용해서 자바 메소드를 호출해보려 했는데 페이지 로드시 실행됨-->
    <!--                        <a th:onclick="|${@cartServiceImpl.deleteProductInCart(cart.cartNo)}|" href="trolley">-->
    <!--                        <a th:onclick="|deleteProductInCart(${ cart.cartNo })|" href="trolley">-->
    <!--                            <img src="/img/cart/trash.png" alt="trash.png">-->
    <!--                        </a> -->
    <!--                        <button type="button" class="trashCan" th:onclick="|deleteProductInCart(${ cart.cartNo })|">-->
    <!--                            <img src="/img/cart/trash.png" alt="trash.png">-->
    <!--                        </button>-->
                            <input type="image" th:onclick="|deleteProductInCart(${ cart.cartNo })|" src="/img/cart/trash.png" alt="trash.png"/>
                        </div>
                    </div>
                </div>
            </th:block>
        <hr class="thick-line">
        <!--결제 금액-->
        <div class="row">
            <div class="col-lg-8">

            </div>

            <div class="col-lg-2 price">
                Order Total
            </div>

            <div class="col-lg-2 price">
    <!--            3000$-->
<!--                <span id="orderTotal" th:text="${ totalPrice }" th:value="${ totalPrice }" style="display: inline-block"/>-->
                <span id="orderTotal"/>
            </div>
        </div>
        <!--포인트(할인 가격)-->
        <input id="point" type="hidden" th:value="${ user.point }">
        <div class="row">
            <div class="col-lg-8">

            </div>
            <div class="col-lg-2 price">
                <!--                Discount Price(Point)-->
                Point
            </div>
            <div class="col-lg-2 price">
<!--                <span id="userPoint" th:text="${ user.point }" th:value="${ user.point}"/>$-->
                <span id="userPoint" style="display: inline-block"/>
            </div>
        </div>
        <!--합산 가격-->
        <div class="row">
            <div class="col-lg-8">
            </div>
            <div class="col-lg-2 price">
                Sub Total
            </div>
            <div class="col-lg-2 price">
                <span id="subTotal" style="display: inline-block"/>
            </div>
        </div>
        <br>
        <!--/*전달할 데이터*/-->
<!--        <span th:text="${#calendars.format(#calendars.createNow())}"/>-->
        <form th:action="@{order}" th:object="${paymentDTO}" th:method="post">
            <input type="number" th:field="*{paymentNo}">
            <input type="text" th:value="${ user.userId }" name="userId">
            <input type="number" th:value="${ user.point }" name="usedPoint">
            <input type="number" value="0" id="totalPrice" name="paymentAmount">
            <input type="text" th:field="*{paymentMethod}">
            <input type="text" th:field="*{receiverName}">
            <input type="text" th:field="*{receiverTel}">
            <input type="text" th:field="*{address}">
<!--            <input type="date" th:field="*{paymentDate}">-->
            <input type="date" th:value="0001-01-01" name="paymentDate">
<!--            <input type="date" id="currentDate" name="paymentDate">-->
            <input type="text" value="배송 준비중" name="shippingStatus">
            <input type="text" th:field="*{deliveryRequires}">
<!--        <form id="cartData" th:action="@{order}" th:object="${purchaseList}" th:method="post">-->
<!--            <th:block th:each="cart : ${cartList}">-->
<!--&lt;!&ndash;                <input th:id="${p}" type="number" th:field="${item}">&ndash;&gt;-->
<!--                <input th:id="|cart${cart.cartNo}|" type="number" th:value="${cart.cartNo}" th:name="${cartStat.index}">-->
<!--&lt;!&ndash;                <input th:id="${}" type="number" th:field="${}">&ndash;&gt;-->
<!--            </th:block>-->
<!--        </form>-->
        <!--구매 버튼-->
        <div class="row">
            <div class="col-lg-10">
            </div>
            <div class="col-lg-2">
<!--                <button type="submit" class="goldButton" onclick="location.href='order'">Purchase</button>-->
                <button type="submit" class="goldButton" onclick="window.location.href='order'">Purchase</button>
            </div>
        </div>
        </form>
    </div>
</body>
</html>